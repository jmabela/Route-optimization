{% extends 'base.html' %}
{% block title %}ROUTES HOME{% endblock %}

{% block body %}
<!DOCTYPE html>
<html>
    <style>
   


    html,
body,
#map_canvas {
  height: 100%;
  width: 100%;
  margin: 0px;
  padding: 0px
}
    </style>

    
<body>

<h1>My First Google Map</h1>


<div id="map_canvas"></div>
<script>
     // here you can play with query
     //query ideas killing me
     //im done
     //bye
     //Select places_id from trips where trip_id=trip_id


</script>


<script>


var sessionData = {{session|tojson}};
console.log(sessionData['placeid_list'])


let placeIdList = sessionData["placeid_list"];

var geocoder;
var map;

function getRoute() {
    let numberOfIds = placeIdList.length;
    var origin_id = placeIdList[0];
    console.log(numberOfIds);
    console.log("before remove origin ", placeIdList);
    placeIdList.splice(0, 1);
    console.log("after remove origin ", placeIdList);
    var destination_id = placeIdList[placeIdList.length-1];
    console.log("before remove dest ", placeIdList);
    placeIdList.splice(placeIdList.lenght-1, 1);
    console.log("after remove dest ", placeIdList);
    var waypoints_list = [];
    for (place of placeIdList) {
        let = waypoint = {
            stopover: true,
            location: {
            placeId: place, 
            }
        }
        waypoints_list.push(waypoint);
    }

    console.log("origin: ", origin_id);
    console.log("dest:,", destination_id);
    console.log("waypoints: ", waypoints_list);


    var map = new google.maps.Map(
    document.getElementById("map_canvas"), {
      center: new google.maps.LatLng(53.9191545, 27.602728299999967),
      zoom: 13,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });
  var directionsService = new google.maps.DirectionsService();

  directionsService.route({
    origin: {
      placeId: origin_id
    },
    destination: {
      placeId: destination_id
    },
    
    waypoints: waypoints_list,
    optimizeWaypoints: true,
    travelMode: google.maps.TravelMode.DRIVING
  }, function(result, status) {
    var dirDisp = new google.maps.DirectionsRenderer({
      map: map
    })
    dirDisp.setDirections(result)
    // print out cities from this result thingy!!!!
  });

}


google.maps.event.addDomListener(window, "load", getRoute());


</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjxvpRP54gUz4CZGxGLF_yxGY-wQ5-lpg&callback=getRoute"></script>

</body>
</html>  

{% endblock %}